# Ð’ Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… ich_edit Ñ‚Ñ€Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹. Users Ñ Ð¿Ð¾Ð»ÑÐ¼Ð¸ (id, name, age), Products Ñ Ð¿Ð¾Ð»ÑÐ¼Ð¸ (pid, prod,
# quantity) Ð¸ Sales Ñ Ð¿Ð¾Ð»ÑÐ¼Ð¸ (sid, id, pid). ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑƒÐ¼ÐµÐµÑ‚
# Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ñ€Ð°Ð·Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹.
# 1. Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð´Ð»Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°. ÐŸÑ€ÐµÐ´ÑƒÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ð°Ð±Ð»Ð¸Ñ†.
# Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¸Ñ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ, ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ð¸Ð»Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ.
# 2. Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¾Ð´Ð½Ð¾ Ð¿Ð¾Ð»Ðµ Ð¸Ð· Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð¸ Ð¸ÑÐºÐ¾Ð¼Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ð¾Ð»Ñ. Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð²ÑÐµ
# Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸
# 3. Ð’Ð²ÐµÑÑ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð»ÐµÐ¹ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹.
# 4. ÐŸÑ€Ð¸ Ð²Ð²Ð¾Ð´Ðµ Ð¸ÑÐºÐ¾Ð¼Ð¾Ð³Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð·Ð½Ð°ÐºÐ° - Ð½Ð°Ð¹Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ¸, Ð²
# ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð±Ð¾Ð»ÑŒÑˆÐµ, Ð¼ÐµÐ½ÑŒÑˆÐµ Ð¸Ð»Ð¸ Ñ€Ð°Ð²Ð½Ð¾ Ð²Ð²ÐµÐ´ÐµÐ½Ð½Ð¾Ð¼Ñƒ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑŽ.


from manager_mysql import MySQLConnection
from local_settings import dbconfig


if __name__ == "__main__":

    with MySQLConnection(dbconfig) as db_manager:
        result = db_manager.show_tables()
        print(f"Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð±Ð°Ð·Ñ‹ {dbconfig["database"]}: \n" + ", ".join(item[0] for item in result))

    print("Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹: Users, Products, Sales")
    tables = input("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ† Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ: ").replace(" ", "").split(",")
    with MySQLConnection(dbconfig) as db_manager:
        result = db_manager.join_tables(tables)
        if result is None:
            exit()
        columns = [desc[0] for desc in db_manager.cursor.description]
        print("\nÐ ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°:")
        for row in result:
            print(dict(zip(columns, row)))

        all_fields = {}
        for table in tables:
            for field in db_manager.get_fields(table):
                all_fields[f"{table}.{field}"] = field

        #print("\n1. ðŸ” Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð¿Ð¾Ð»ÑŽ")
        print("Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ°:")
        for i, full_field in enumerate(all_fields, 1):
            print(f"{i}. {full_field}")

        field_num = int(input("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½Ð¾Ð¼ÐµÑ€ Ð¿Ð¾Ð»Ñ Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸: "))
        selected_full_field = list(all_fields.keys())[field_num - 1]
        selected_table, selected_field = selected_full_field.split(".")
        operator = input("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ (=, >, <): ")
        value = input("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ°: ")
        filtered_query = f" WHERE {selected_table}.{selected_field} {operator} %s"
        result = db_manager.join_tables(tables,[filtered_query,(value,)])
        if result is None:
            exit()
        columns = [desc[0] for desc in db_manager.cursor.description]
        print("\nÐ ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°:")
        for row in result:
            print(dict(zip(columns, row)))
        # Users, Products, Sales
